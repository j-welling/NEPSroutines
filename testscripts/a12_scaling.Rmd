
---
title: "Scaling study A12 (Grammar) with the NEPSroutines package"
author: "Jana Welling"
date: "`r Sys.time()`"
output:
    html_document:
    toc: true
number_sections: true
toc_float: true
theme: readable
highlight: tango
df_print: paged
code_folding: show
editor_options: 
  chunk_output_type: console
---

# Preparation of R and data

## Load data

```{r load-data, warning = FALSE, message = FALSE, comment = NA, results = 'hide'}
load(here::here('Test/A12/Version 1.1.0/Data/data.Rdata'))
```

## Load NEPSroutines package

```{r load-NEPSroutines-package, eval = FALSE}
pkgload::load_all(here::here('NEPSroutines'))
```


# Sample and booklet descriptives

```{r descriptives}
# Sample size with only valid cases
NEPSroutines::n_valid(resp, valid = 'valid_new_set')

# Descriptives (mean, sd, etc.) of continuous variables
NEPSroutines::desc_con(resp, desc = 'age', valid = 'valid_new_set')

# Descriptives (attributes, frequency) of nominal sociodemographic variables
NEPSroutines::desc_nom(resp, desc = c('sex', 'migration', 'books'), valid = 'valid_new_set')
NEPSroutines::show_attributes(resp, desc = c('sex', 'migration', 'books'))
```


# Missing responses analyses

## Missing responses by person

```{r missing responses by person}
NEPSroutines::mv_person(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  mvs = mvs,
  labels_mvs = labels_mvs,
  overwrite = TRUE,
  color = 'blue',
  plots = TRUE,
  save = FALSE,
  print = FALSE,
  return = FALSE,
  path_results = 'Test/A12/Version 1.1.0/Results',
  path_table = 'Test/A12/Version 1.1.0/Tables',
  path_plots = 'Test/A12/Version 1.1.0/Plots/Missing_Responses/by_person',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```

## Missing responses by item

```{r missing responses by item}
NEPSroutines::mv_item(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  position = 'position_new_set',
  mvs = mvs,
  labels_mvs = labels_mvs,
  overwrite = TRUE,
  color = 'blue',
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'Test/A12/Version 1.1.0/Results',
  path_table = 'Test/A12/Version 1.1.0/Tables',
  path_plots = 'Test/A12/Version 1.1.0/Plots/Missing_Responses/by_item',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```


# IRT analyses

```{r IRT analysis with dichotomous items}
NEPSroutines::irt_analysis(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  scoring = 'scoring',
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'Test/A12/Version 1.1.0/Results',
  path_table = 'Test/A12/Version 1.1.0/Tables',
  path_plots = 'Test/A12/Version 1.1.0/Plots',
  overwrite = TRUE,
  digits = 2,
  verbose = FALSE
)
```


# DIF analysis

```{r dif analysis for Rasch}
dif_analysis(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  dif_vars = c('sex', 'migration', 'books'),
  scoring = 'scoring',
  overwrite = TRUE,
  verbose = FALSE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'Test/A12/Version 1.1.0/Results',
  path_table = 'Test/A12/Version 1.1.0/Tables'
)
```


# Distractor analysis

Scaling of A12 does not include distractor analysis, as data from the SUF (and therefore only scored items) are used.


# Dimension analysis

Scaling of A12 does not include dimension analysis.


# Create scores and SUF

```{r suf}
# Note that this creates the scores and the SUF without linking and without rotation, only for testing purposes
scores <- create_scores(
  resp,
  vars,
  score_name = 'grk1',
  select = 'new_set',
  valid = 'valid_new_set',
  wle = TRUE,
  sum_score = TRUE,
  metap = FALSE,
  return = TRUE,
  save = TRUE,
  path_results = 'Test/A12/Version 1.1.0/Results'
)

create_suf(
  resp,
  vars,
  select = 'new_set',
  competence = 'Grammar',
  scores = scores,
  score_name = 'grk1',
  return = FALSE,
  path = 'Test/B129/Version 1.1.0/SUF'
)

rm(scores)
```


# Session

```{r session-info}
sessionInfo()
```
