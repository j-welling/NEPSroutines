
---
title: "Scaling study A14 (Grammar) with the scaling package"
author: "Jana Welling"
date: "`r Sys.time()`"
output:
  html_document:
    toc: true
    number_sections: true
    toc_float: true
    theme: readable
    highlight: tango
    df_print: paged
    code_folding: show
editor_options: 
  chunk_output_type: console
---

# Preparation of R and data

## Set working directory
```{r working directory}
setwd('Z:/Projektgruppen_(08)/Kompetenzen_BA_Hiwi_(p000012)/Methoden/Skalierung/Skalierungspaket')
```

## Load data

```{r load-data, warning = FALSE, message = FALSE, comment = NA, results = 'hide'}
rm(list = ls())
load(here::here('Test/A14/Version 1.1.0/Data/data.Rdata'))
# Problem: wegen Linking sind Items doppelt in vars enthalten
# load('Z:/Projektgruppen_(08)/Kompetenzen_BA_Hiwi_(p000012)/Methoden/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Data/data.Rdata')
```

## Load scaling package

```{r load-scaling-package, eval = FALSE}
pkgload::load_all(here::here('scaling'))
# pkgload::load_all('Z:/Projektgruppen_(08)/Kompetenzen_BA_Hiwi_(p000012)/Methoden/Skalierung/Skalierungspaket/scaling')
```


# Debugging

```{r 'debugging', eval = FALSE}
# Hier k√∂nnte DEIN Debugging stehen :)
```


# Sample and booklet descriptives

```{r descriptives}
# Sample size with only valid cases
scaling::n_valid(resp, valid = 'valid_new_set')

# Descriptives (mean, sd, etc.) of continuous variables
scaling::desc_con(resp, desc = 'age', valid = 'valid_new_set')

# Descriptives (attributes, frequency) of nominal sociodemographic variables
scaling::desc_nom(resp, desc = c('sex', 'migration', 'books'), valid = 'valid_new_set')
scaling::show_attributes(resp, desc = c('sex', 'migration', 'books'))

# Descriptives (attributes, frequency) of nominal booklet variables
scaling::desc_nom(resp, desc = c('pos', 'vers'), valid = 'valid_new_set')
scaling::show_attributes(resp, desc = c('pos', 'vers'))
```


# Missing responses analyses

## Missing responses by person

```{r missing responses by person}
scaling::mv_person(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  mvs = mvs,
  labels_mvs = labels_mvs,
  overwrite = TRUE,
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results',
  path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Tables',
  path_plots = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Plots/Missing_Responses/by_person',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```

## Missing responses by item

```{r missing responses by item}
scaling::mv_item(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  position = 'position_new_set',
  mvs = mvs,
  labels_mvs = labels_mvs,
  overwrite = TRUE,
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results',
  path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Tables',
  path_plots = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Plots/Missing_Responses/by_item',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```


# IRT analyses

## Old set (only dichotomous items)

```{r Rasch and 2PL}
scaling::irt_analysis(
  resp = resp,
  vars = vars,
  select = 'old_set',
  valid = 'valid_old_set',
  overwrite = TRUE,
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results',
  path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Tables',
  path_plots = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Plots',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```

## New set (also polytomous items)

```{r PCM and GPCM}
scaling::irt_analysis(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  scoring = 'scoring',
  overwrite = TRUE,
  plots = TRUE,
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results',
  path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Tables',
  path_plots = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Plots',
  digits = 2,
  warn = TRUE,
  verbose = FALSE
)
```


# DIF analysis (for PCM)

```{r dif analysis for PCM}
scaling::dif_analysis(
  resp = resp,
  vars = vars,
  select = 'new_set',
  valid = 'valid_new_set',
  dif_vars = c('sex', 'migration', 'books', 'pos', 'vers'),
  scoring = 'scoring',
  overwrite = TRUE, 
  save = TRUE,
  print = TRUE,
  return = FALSE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results',
  path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Tables'
)
```


# Distractor analysis

Scaling of A14 does not include distractor analysis, as data from the SUF (and therefore only scored items) are used.


# Dimension analysis

Scaling of A14 does not include dimension analysis.


# Linking

```{r linking}
# load('Test/A14/Version 1.1.0/Data/link_data.Rdata')
# 
# link <- linking(
#   resp_curr = resp_A14,
#   resp_prev = resp_A12,
#   vars_curr = vars_A14,
#   vars_prev = vars_A12,
#   select_curr = 'link',
#   select_prev = 'link',
#   scoring_curr = 'scoring',
#   scoring_prev = 'scoring',
#   valid_curr = 'valid_new_set',
#   valid_prev = 'valid_new_set',
#   longitudinal = TRUE,
#   anchors = common,
#   mvs = mvs_link,
#   overwrite = TRUE,
#   return = TRUE,
#   save = TRUE,
#   print = TRUE,
#   path_table = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Linking', 
#   path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Linking',
#   do_dif = TRUE,
#   do_dim = FALSE
# )
```


# Create scores and SUF

```{r suf}
# Note that this creates the scores and the SUF without linking and without rotation, only for testing purposes
scores <- scaling::create_scores(
  resp = resp,
  vars = vars,
  score_name = 'grg1',
  select = 'new_set',
  valid = 'valid_new_set',
  wle = TRUE,
  sum_score = TRUE,
  metap = FALSE,
  return = TRUE,
  save = TRUE,
  path_results = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/A14/Version 1.1.0/Results'
)

scaling::create_suf(
  resp = resp,
  vars = vars,
  select = 'new_set',
  competence = 'Grammar',
  scores = scores,
  score_name = 'grg1',
  mvs = mvs,
  return = FALSE,
  path = 'C:/Users/ba4eb5/Desktop/Skalierung/Skalierungspaket/Test/B129/Version 1.1.0/SUF'
)

rm(scores)
```


# Session

```{r session-info}
sessionInfo()
```
